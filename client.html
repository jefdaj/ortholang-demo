<html>
<meta charset="utf-8"/>
<title>ShortCut Demo Server</title>

<script type="text/javascript" src="jquery-3.3.1.js"></script>
<script type="text/javascript" src="socket.io.dev.js"></script>

<style>
#content, html, body {
	height: 98%;
}
#left {
	float: left;
	width: 50%;
	height: 95%;
}
#right {
	float: left;
	width: 50%;
	height: 100%;
	overflow-y: scroll;
}
#logo {
	display: block;
	margin-left: auto;
	margin-right: auto;
	width: 50%;
}
</style>

<script>
function autofill_repl(text) {
	i = $('#replinput');
	i.val(text); // TODO strip trailing newline here?
	i.focus();
}

$(document).ready(function(){

	// TODO would explicit disconnect help?
	// TODO figure out timeouts
	var socket = io.connect('http://localhost:5000');

	// send a line to the repl when you click send
	$('#runstop').on('click', function() {
		socket.emit('repl input', $('#replinput').val());
		$('#replinput').val('')
	});
	$('#replinput').on('keypress', function(e) {
		if(e.which == 13) {
			socket.emit('repl input', $('#replinput').val());
			$('#replinput').val('');
		};
	});

	// display a line of output sent from the repl
	// TODO don't add the >> unless it was a line of input (don't send those from server at all?)
	socket.on('append message', function(msg) {
		$('#reploutput').append(msg);
	});

	// submit a comment
	$('#commentbutton').on('click', function() {
		socket.emit('comment', $('#commentfield').val());
		$('#commentfield').val('')
		// TODO can I set the placeholder to say comment recieved?
	});

	// autofill repl with :load to load a previous script
	// TODO same issue with it disappearing as the save one below...
	$('#loadbutton').on('click', function() {
		autofill_repl(':load ' + $('#loadmenu').val())
	});

	// autofill repl input with :write to save a script
	$('#savebutton').on('click', function() {
		filename = $('#filename').val()
		if (filename != '') {
			autofill_repl(':write ' + filename)
		}
	});
	$('#filename').on('keypress', function(e) {
		if(e.which == 13) {
			// TODO have to strip out the newline or it auto-triggers the repl too?
			// TODO or maybe block default action so it doesn't get added at first
			autofill_repl(':write ' + $('#filename').val())
		};
	});

});
</script>


<div id="content" style="height: 100%;">
	<div id="left" style="text-align: center;">
		<div style="width: 95%; display: inline-block;">
			<div> <!-- TODO why another div besides left? -->
				<div id="logodiv" style="diplay: table;">
					<img id="logo" src="logo.png" style="width: 125px;">
					ShortCut Demo Server
				</div>
				<br/>
				<div style="border-style: solid; border-width: 1px;">
					<!-- TODO how to make height auto-expand? -->
					<div id="reploutput" style="text-align: left; width:100%; height: 55%;">
						Welcome to the ShortCut interpreter!
						<br/>
						Type :help for a list of available commands.</br></div>
					<!-- TODO this could be one run/kill button at the end of the entry line that toggles when a script is running -->
					<div>
						<input id="replinput" type="text" style="width: 90%;" placeholder=">> " autofocus style="float: left;">
						<button id="runstop" style="display: inline; text-align: center;">Run</button>
					</div>
				</div>
				<br/>
				<div style="display: inline-block; width: 100%;">
					<form id="script">

						<!-- TODO group these by top row being autofills and bottom being server actions -->

						<!-- load/upload -->
						<div style="float: left; width: 45%; text-align: left;">
							<button id="loadbutton">Load script</button>
							<select id="loadmenu">
								<option value="userscript1.cut">userscript1.cut</option>
								<option value="johan.cut">johan.cut</option>
								<option value="another.cut">another.cut</option>
							</select>
							<br/>
							<br/>
							<button id="uploadbutton">Upload file</button>
							<input id="upload" type="file" accept="*">
						</div>

						<div style="float: right; width: 45%; text-align: left;">
							<!-- save/download -->
							<button id="savebutton">Save script</button>
							<input id="filename" type="text" name="scriptname" placeholder="your-script-name.cut">
							<br/>
							<br/>
							<input id="dlscript" type="submit" value="Download script">
							<input id="dlresult" type="submit" value="Download result">
						</div>

					</form>
				</div>
				<br/>
				<br/>

				<div>
						<textarea id="commentfield" placeholder="Leave Jeff a comment! Include your name if you want a response." style="width:100%; height: 5%; expand: vertical; resize: vertical; float: left;"></textarea>
						<button id="commentbutton" style="float: right;">Submit comment</button>
				</div>
			</div>
		</div>
	</div>
	<div id="right">
		<div style="width: 95%;">
			<p>This side will be a tutorial with a bunch of examples. Each example will have a little "load" or "try it" button that pastes the code in the box on the left. Remaining text is filler for now...</p>

			<center>
				<div style="text-align: left; width: 90%; border-style: solid; border-width: 1px;">
					<form id="tutorial1" style="float: right;">
						<input type="button" onclick="autofill_repl(':load tutorial1.cut')" name="submit" value="Load">
					</form>
					<pre><code>test code block 1</pre></code>
				</div>
			</center>

			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce nec lorem mauris. Nulla fermentum tincidunt nulla et dignissim. In porttitor sem id velit lobortis aliquam. Duis et purus ac orci porttitor luctus at quis leo. Mauris vulputate pellentesque est, sit amet egestas tellus facilisis sit amet. Cras sodales bibendum tellus, a gravida tortor hendrerit sed. Pellentesque blandit posuere nisl, sit amet cursus nisl dignissim non.</p>

			<p>Vivamus at orci sit amet elit lacinia posuere sit amet malesuada elit. Duis quis luctus magna. Phasellus pharetra urna a dolor vulputate ultrices. Nam ornare orci justo, et fringilla lacus. Etiam tristique enim sed enim tempus tincidunt. Fusce rutrum dui at erat iaculis suscipit. Aenean id urna sit amet arcu pulvinar accumsan. Aenean malesuada, nisi sed ultricies tempus, elit nisl interdum leo, sit amet bibendum eros arcu pretium nisi. Nam magna dolor, lacinia adipiscing iaculis ac, viverra sit amet ligula. Fusce vitae est sit amet ipsum iaculis molestie a ac nisi. Curabitur porta nunc quis magna interdum nec hendrerit ligula suscipit. Curabitur non accumsan sapien. Donec non ligula a lorem lobortis scelerisque ac a sem. Sed porta blandit odio a ullamcorper.</p>

			<center>
				<div style="text-align: left; width: 90%; border-style: solid; border-width: 1px;">
					<form id="tutorial1" style="float: right;">
						<input type="button" onclick="autofill_repl(':load tutorial2.cut')" name="submit" value="Load">
					</form>
					<pre><code>test code block 2</pre></code>
				</div>
			</center>


			<p>Mauris in suscipit quam. Duis sit amet ipsum purus. Donec sed nunc lacus. Cras mattis felis quis lacus ultrices pharetra tristique nibh venenatis. In id eros sed libero iaculis commodo quis vitae neque. Nulla gravida neque in tortor congue id mattis massa auctor. Cras auctor tincidunt ipsum, in suscipit risus iaculis sed. Nulla at eros nec urna auctor tincidunt eu ac diam. Aenean nulla metus, accumsan eu dignissim vitae, congue sed nisl.</p>

			<p>Pellentesque ut nunc eget metus malesuada vulputate ac aliquam nibh. Pellentesque felis erat, tristique nec semper vel, dignissim ut nisl. Donec ac dui purus. Nunc in ligula lacus. In vehicula scelerisque convallis. Ut in ornare ante. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Etiam et libero a nibh venenatis tristique vitae vitae ligula. Phasellus vitae tempor ante.</p>

			<center>
				<div style="text-align: left; width: 90%; border-style: solid; border-width: 1px;">
					<form id="tutorial1" style="float: right;">
						<input type="button" onclick="autofill_repl(':load tutorial3.cut')" name="submit" value="Load">
					</form>
					<pre><code>test code block 3</pre></code>
				</div>
			</center>


			<p>Proin egestas commodo enim. Curabitur eu justo non felis tempus fermentum ut vitae augue. Ut cursus ultrices metus eu vehicula. Praesent sem nulla, eleifend eget adipiscing a, tempor sit amet lectus. Suspendisse congue fringilla urna vitae dapibus. Phasellus iaculis, velit at ornare feugiat, nunc dolor scelerisque dolor, sed placerat enim magna sit amet magna. Quisque gravida arcu eu neque porttitor rutrum. Donec tempus urna interdum libero faucibus ac lacinia sapien bibendum. Quisque sed odio et metus molestie tincidunt. Sed congue mauris non ante pharetra eu facilisis velit rhoncus. Aenean dictum purus sit amet tortor ultricies auctor. Aliquam nunc quam, porttitor porta fringilla et, bibendum sit amet urna. Vestibulum id tellus sed ipsum dignissim pharetra. Quisque non ipsum nec mauris ullamcorper interdum non et velit.</p>

			<p>Fusce lorem leo, molestie nec ultricies a, vulputate a ante. Aenean vel mauris libero, sit amet tempor sapien. Suspendisse vel purus sit amet nunc placerat suscipit tincidunt et arcu. Donec sit amet magna diam. Nam a lacus libero. Proin vitae lectus at lorem rhoncus aliquet ut ut ligula. Nam ante dui, placerat quis fermentum quis, eleifend ac justo. Morbi gravida urna eu risus scelerisque id tempus leo adipiscing. Morbi vel libero eu felis congue venenatis sed eget tellus. Ut metus libero, auctor sed congue eu, fringilla vel purus. Donec urna lorem, congue ac dapibus in, sollicitudin id nunc. Sed ullamcorper, nibh imperdiet ullamcorper ultrices, tortor leo elementum elit, sit amet auctor lectus justo et sem.</p>

			<p>Pellentesque sit amet erat sed orci ultricies rutrum sed eget est. Aenean quis elit arcu, ac rhoncus magna. Suspendisse eu magna vitae ligula porta condimentum sit amet et lacus. Donec at varius erat. Curabitur semper dapibus lorem ac faucibus. Praesent ornare vehicula nisi in fermentum. Curabitur viverra lectus in odio dictum sed imperdiet magna vulputate. In hac habitasse platea dictumst. Suspendisse potenti. Proin facilisis, nunc et laoreet ornare, justo quam ultrices nibh, ut suscipit lectus nib quam congue eget egestas est luctus. Donec quis viverra nisi. Mauris porta porttitor vehicula. Nulla facilisi. Maecenas libero nibh, auctor sed pellentesque sit amet, facilisis eu arcu. Praesent ut interdum ligula. Curabitur ac elit vehicula urna lobortis tempus. Cras venenatis iaculis urna, eget pellentesque neque pulvinar quis.</p>

			Vivamus diam enim, egestas dictum semper nec, sagittis et velit. Cras elementum suscipit sapien nec bibe
		</div>
	</div>
</div>
</html>
