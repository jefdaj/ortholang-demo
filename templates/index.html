<html>
<head>
	<title>ShortCut Demo Server</title>
	<meta charset="utf-8"/>
	<script type="text/javascript" src="{{ url_for('static',filename='jquery-3.3.1.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static',filename='socket.io.dev.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static',filename='index.js') }}"></script>
	<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='index.css') }}">
</head>

<body>

<div id="content" style="height: 100%;">
	<div id="left" style="text-align: center;">
		<div style="width: 95%; display: inline-block;">
			<div> <!-- TODO why another div besides left? -->
				<div id="logodiv" style="diplay: table;">
					<img id="logo" src="/static/server.png" style="width: 125px;">
					"The Zilputer"
					<br/>
					ShortCut Demo Server
				</div>
				<br/>
				<div style="border-style: solid; border-width: 1px;">
					<!-- TODO how to make height auto-expand? -->
					<div id="replstdout" style="text-align: left; width:100%; height: 55%; overflow-y: scroll;"></div>
					<!-- TODO this could be one run/kill button at the end of the entry line that toggles when a script is running -->
					<div>
						<input id="replstdin" type="text" style="width: 90%;" placeholder=">>" autofocus style="float: left;">
						<button id="runstop" style="display: inline; text-align: center;">Run</button>
					</div>
				</div>
				<br/>
				<div style="display: inline-block; width: 100%;">
					<form id="script">

						<!-- TODO group these by top row being autofills and bottom being server actions -->

						<!-- load/upload -->
						<div style="float: left; width: 45%; text-align: left;">
							<button id="loadbutton">Load script</button>
							<select id="loadmenu">
								<option value="userscript1.cut">userscript1.cut</option>
								<option value="johan.cut">johan.cut</option>
								<option value="another.cut">another.cut</option>
							</select>
							<br/>
							<br/>
							<button id="uploadbutton">Upload file</button>
							<input id="upload" type="file" accept="*">
						</div>

						<div style="float: right; width: 45%; text-align: left;">
							<!-- save/download -->
							<button id="savebutton">Save script</button>
							<input id="filename" type="text" name="scriptname" placeholder="your-script-name.cut">
							<br/>
							<br/>
							<input id="dlscript" type="submit" value="Download script">
							<input id="dlresult" type="submit" value="Download result">
						</div>

					</form>
				</div>
				<br/>
				<br/>

				<div>
						<textarea id="commentfield" placeholder="Leave Jeff a question/comment/bug report! Paste anything relevant here too, and include your name if you want a response." style="width:100%; height: 5%; expand: vertical; resize: vertical; float: left;"></textarea>
						<button id="commentbutton" style="float: right;">Submit comment</button>
				</div>
			</div>
		</div>
	</div>
	<div id="right">
		<div style="width: 95%;">
{% filter markdown %}

Phylogenomic cuts are lists of candidate genes whose distribution suggests they
might be imprortant for a trait of interest.

Cut script is a simple language for making phylogenomic cuts. It aims to be the
easiest way to conduct searches too complex for the NCBI website, but maybe not
so complex that you want to get bogged down with all the details of a "real"
language like Python or R just to do some BLAST searches. It also aims to
describe searches succinctly and reproducibly, so that some day it might make
it into your supplemental material. Everyone wins when your work is easy to
build on!

The `shortcut` program is a command-line language interpreter, kind of like
`python` or `R` but for cut scripts. On your left is a hacky "terminal" I made
so it can be run from a web browser. You can do most of the same things in it
that you could if you downloaded ShortCut proper, except:

* Your session will be deleted when you leave this page
* The server might kill your script without warning if it takes too much CPU time
* Some terminal niceties like tab completion and clearing the screen are missing

You can upload your own genomes and gene lists, save and restore scripts,
and download results using the buttons at the bottom left. *Note: buttons don't work yet*

## Quick Start

OK, so what can you do with it? These examples are explained in more detail
below, but let's try running them first. Press one of the `Load` buttons to
fill in the command to load that example. Once it's loaded type `:show` to show
the variable definitions, then `result` to run everything.

{% endfilter %}
{% with path='examples/quick01.cut' %} {% include "example.html" %} {% endwith %}
{% filter markdown %}

{% endfilter %}
{% with path='examples/quick02.cut' %} {% include "example.html" %} {% endwith %}
{% filter markdown %}

{% endfilter %}
{% with path='examples/quick03.cut' %} {% include "example.html" %} {% endwith %}
{% filter markdown %}

_Note: these mostly use BLAST, but multiple sequence alignments +
tree building + clustering are in the works too._

## Tutorial

Let's start at the beginning...

### `result` and other variables

If you type a plain expression like `4 * 4` without assigning it to a variable,
the interpreter assigns it to `result` by default.
So `result` always holds the latest result.
You can also assign it yourself when the script is done to say what the final result should be.

This is probably the simplest script you could write:

{% endfilter %}
{% with path='examples/tutorial01.cut' %} {% include "example.html" %} {% endwith %}
{% filter markdown %}

If you downloaded ShortCut and ran `shortcut --script examples/tutorial01.cut`, it would print
`"hello world!"`.

You don't have to run the whole script at once though.
You'll spend most of your time editing it in the interpreter,
defining and evaluating individual variables.
Here is a script with several of them.

{% endfilter %}
{% with path='examples/tutorial02.cut' %} {% include "example.html" %} {% endwith %}
{% filter markdown %}

ShortCut keeps track of dependencies between variables, like this:

![]({{ url_for('static',filename='vars.svg') }})

You can evaluate one of them by typing its name.
ShortCut will point `result` to that variable if needed,
evaluate the dependencies (`var1`, `var3`, `var4`),
then print `result`.

So, if you type `result` or `var4` here the graph will stay the same and
ShortCut will print `-1.485`.  Then if you type `var2`, the graph will change to:

![]({{ url_for('static',filename='var2.svg') }})

... and it will print `"nothing depends on var2 so far"`.

{% endfilter %}
		</div>
	</div>
</div>
	</body>
</html>
